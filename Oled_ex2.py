from machine import Pin, I2C
from ssd1306 import SSD1306_I2C
import framebuf,sys


def get_img():
    img = bytearray(b'BM>\x02\x00\x00\x00\x00\x00\x00>\x00\x00\x00(\x00\x00\x00@\x00\x00\x00@\x00\x00\x00\x01\x00\x01\x00\x00\x00\x00\x00\x00\x02\x00\x00\xc4\x0e\x00\x00\xc4\x0e\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\xff\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x18\x00\x00\x00\x00\x00\x00\x00\x18\x00\x00\x00\x00\x00\x00\x00\x18\x00\x00\x00\x00\x00\x00\x00\x18\x00\x00\x00\x00\x00\x00\x00\x18\x00\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x00\x18`\x00\x00\x00\x00\x00\x07\xff\xff\xc0\x00\x00\x00\x00\x07\xff\xff\xc0\x00\x00\x00\x00\x07\xff\xff\xc0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xfe\x00\x00\x00\x00\x00\x00\xff\xfe\x00\x00\x00\x00\x00\x00\xff\xfe\x00\x00\x00\x00\x00\x00\xff\xfe\x00\x00\x00\x00\x00\x00\xff\xfe\x00\x00\x00\x00\x00\x00\xff\xfe\x00\x00\x00\x00\x00\x00\xff\xfe\x00\x00\x00\x00\x00\x00\xff\xfe\x00\x00\x00\x00\x00\x00\xff\xfe\x00\x00\x00\x00\x00\x00\xff\xfe\x00\x00\x00\x00\x0f\xfe\xff\xfe\x00\x00\x00\x00\x1f\xfe\xff\xfe\xff\xf8\x00\x00\x1f\xfe\x7f\xfc\xff\xf8\x00\x00\x00\x00\x7f\xfc\x00\x00\x00\x00\x00\x00?\xf8\x00\x00\x00\x00\x00\x00\x1f\xf0\x00\x00\x00\x00\x00\x00\xcf\xe0\x00\x00\x00\x00\x00\x01\xc1\x82\x00\x00\x00\x00\x00\x03\x81\x87\x00\x00\x00\x00\x00\x07\x01\x83\x80\x00\x00\x00\x00\x0e\x01\x81\xc0\x00\x00\x00\x00\x1c\x01\x80\xe0\x00\x00\x00\x008\x01\x80p\x00\x00\x00\x00p\x01\x808\x00\x00\x00\x00\xe0\x01\x80\x1c\x00\x00\x00\x00\x00\x01\x80\x0e\x00\x00\x00\x00\x00\x01\x80\x06\x00\x00\x00\x00\x00\x01\x80\x00\x00\x00\x00\x00\x00\x01\x80\x00\x00\x00\x00\x00\x00\x01\x80\x00\x00\x00')
    img = bytearray([img[ii] for ii in range(len(img)-1,-1,-1)])
    img_res = (64,64)
    return img,img_res

pix_res_x  = 128 # SSD1306 horizontal resolution
pix_res_y = 64   # SSD1306 vertical resolution

i2c_dev = I2C(0,scl=Pin(17),sda=Pin(16),freq=200000)  # start I2C on I2C1 (GPIO 26/27)
i2c_addr = [hex(ii) for ii in i2c_dev.scan()] # get I2C address in hex format
if i2c_addr==[]:
    print('No I2C Display Found') 
    sys.exit() # exit routine if no dev found
else:
    print("I2C Address      : {}".format(i2c_addr[0])) # I2C device address
    print("I2C Configuration: {}".format(i2c_dev)) # print I2C params


oled = SSD1306_I2C(pix_res_x, pix_res_y, i2c_dev) # oled controller

buffer,img_res = get_img() # get the image byte array

# frame buff types: GS2_HMSB, GS4_HMSB, GS8, MONO_HLSB, MONO_VLSB, MONO_HMSB, MVLSB, RGB565
fb = framebuf.FrameBuffer(buffer, img_res[0], img_res[1], framebuf.MONO_HMSB) # MONO_HLSB, MONO_VLSB, MONO_HMSB

oled.fill(0) # clear the OLED
oled.blit(fb, 0, 0) # show the image at location (x=0,y=0)

start_x = 75 # start point for text in x-dir
start_y = 12 # start point for text in y-dir
lineskip = 15 # space between text in y-dir
txt_array = ['RPi','Pico','Demo'] # text array
for iter_ii,txt in enumerate(txt_array):
    oled.text(txt,start_x,start_y+(iter_ii*lineskip)) # add text at (start_x,start_y)

oled.show() # show the new text and image


